<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="modskurt">
<title>Linked zero-inflation • modskurt</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Linked zero-inflation">
<meta property="og:description" content="modskurt">
<meta property="og:image" content="https://hdrab127.github.io/modskurt/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">modskurt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html" aria-label="msktr">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/getting-started.html">How to use `modskurt`</a>
    <a class="dropdown-item" href="../articles/linked-zero-inflation.html">Linked zero-inflation (ZINBL)</a>
    <a class="dropdown-item" href="../articles/prior-specification.html">Prior specification</a>
    <a class="dropdown-item" href="../articles/discrete-stan.html">Stan discrete model</a>
    <a class="dropdown-item" href="../articles/examples.html">Examples</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-other-packages">Other packages</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-other-packages">
    <a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot/">bayesplot</a>
    <a class="external-link dropdown-item" href="http://paul-buerkner.github.io/brms/index.html">brms</a>
    <a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a>
    <a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a>
    <a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a>
    <a class="external-link dropdown-item" href="https://mc-stan.org/projpred">projpred</a>
    <a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a>
    <a class="external-link dropdown-item" href="https://mc-stan.org/rstanarm">rstanarm</a>
    <a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a>
    <a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://mc-stan.org">Stan</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/hdrab127/modskurt" aria-label="Github">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Linked zero-inflation</h1>
            
      
      
      <div class="d-none name"><code>linked-zero-inflation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>ZINBL not really needed unless prop zero &gt; 0.95?</p>
</div>
<div class="section level2">
<h2 id="load-packages-and-stan-files">Load packages and stan files<a class="anchor" aria-label="anchor" href="#load-packages-and-stan-files"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hdrab127.github.io/modskurt/">modskurt</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/compile_stanmodels.html">compile_stanmodels</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Already compiled: discrete.stan"</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># everyone loves a good graph</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123456</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="case-study---sebastes-proriger-vs--water-temperature">Case study - <em>Sebastes proriger</em> vs. water temperature<a class="anchor" aria-label="anchor" href="#case-study---sebastes-proriger-vs--water-temperature"></a>
</h2>
<!-- 2015 data for *Sebastes goodei*, should be pretty hot? -->
<!-- 2015 data for *Thaleichthys pacificus*. -->
<p>2015 data for <em>Sebastes proriger</em> (redstripe rockfish).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">redstripe</span><span class="op">)</span></span>
<span><span class="va">redstripe</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2,330 × 13</span></span></span>
<span><span class="co">##      <span style="font-weight: bold;">trawl_id</span>   <span style="font-weight: bold;">lat</span>   <span style="font-weight: bold;">lng</span> <span style="font-weight: bold;">depth</span> <span style="font-weight: bold;">date</span>       <span style="font-weight: bold;">area_swept</span>    <span style="font-weight: bold;">do</span>  <span style="font-weight: bold;">temp</span>   <span style="font-weight: bold;">sal</span> <span style="font-weight: bold;">total_kg</span></span></span>
<span><span class="co">##         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>    2.01<span style="color: #949494;">e</span>11  34.0 -<span style="color: #BB0000;">120.</span>  57   2012-07-14       1.70 4.58  12.5   33.6        <span style="color: #949494;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>    2.01<span style="color: #949494;">e</span>11  37.8 -<span style="color: #BB0000;">123.</span>  57.2 2010-06-26       1.34 2.01   8.92  34.0        <span style="color: #949494;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>    2.01<span style="color: #949494;">e</span>11  37.8 -<span style="color: #BB0000;">123.</span>  57.6 2012-06-30       1.70 1.03   8.50  34.0        <span style="color: #949494;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>    2.01<span style="color: #949494;">e</span>11  34.6 -<span style="color: #BB0000;">121.</span>  58.6 2008-10-21       1.40 3.95  11.9   33.6        <span style="color: #949494;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>    2.01<span style="color: #949494;">e</span>11  33.9 -<span style="color: #BB0000;">119.</span>  58.6 2013-07-20       1.51 3.10  10.5   33.6        <span style="color: #949494;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>    2.01<span style="color: #949494;">e</span>11  35.1 -<span style="color: #BB0000;">121.</span>  59.1 2010-10-06       1.48 2.69  11.0   33.6        <span style="color: #949494;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>    2.01<span style="color: #949494;">e</span>11  37.7 -<span style="color: #BB0000;">123.</span>  59.2 2013-06-29       1.55 <span style="color: #949494;">0.</span>819  8.71  34.0        <span style="color: #949494;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>    2.01<span style="color: #949494;">e</span>11  34.2 -<span style="color: #BB0000;">119.</span>  59.3 2011-10-11       1.67 4.11  11.2   33.4        <span style="color: #949494;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>    2.01<span style="color: #949494;">e</span>11  42.0 -<span style="color: #BB0000;">124.</span>  59.4 2010-09-16       1.57 2.39   8.55  33.8        <span style="color: #949494;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>    2.01<span style="color: #949494;">e</span>11  40.8 -<span style="color: #BB0000;">124.</span>  59.4 2010-06-22       1.63 2.01   7.28  34.0        <span style="color: #949494;">0</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2,320 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 3 more variables: </span><span style="color: #949494; font-weight: bold;">cpue_kg</span><span style="color: #949494;"> &lt;dbl&gt;, </span><span style="color: #949494; font-weight: bold;">total_count</span><span style="color: #949494;"> &lt;dbl&gt;, </span><span style="color: #949494; font-weight: bold;">cpue_count</span><span style="color: #949494;"> &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="a--specify-initial-model">A. Specify initial model<a class="anchor" aria-label="anchor" href="#a--specify-initial-model"></a>
</h2>
<p><span class="math display">\[
\begin{aligned}
y_n &amp;\sim \text{ZINBL}\left[\mu_n = \text{Modskurt}(x_n), \kappa,
\pi_n\right] \\
\pi_n &amp;= \gamma_0 - \gamma_1 \cdot \mu_n
\end{aligned}
\]</span></p>
<p>with parameters:</p>
<p><span class="math display">\[
\begin{align}
\kappa &amp;\sim \text{Exponential}(0.5) \\
\gamma_0 &amp;\sim \text{Normal}(3.0, 1.5) \\
\gamma_1 &amp;\sim \text{HalfNormal}(3.0)
\end{align}
\]</span></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/mskt_spec.html">mskt_spec</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">redstripe</span>,</span>
<span>            <span class="co"># by including effort below, we are atually modelling catch per unit</span></span>
<span>            <span class="co"># effort (CPUE) while retaining the discrete distribution of these</span></span>
<span>            <span class="co"># count data</span></span>
<span>            y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Sebastes proriger (CPUE)'</span> <span class="op">=</span> <span class="st">'total_count'</span><span class="op">)</span>,</span>
<span>            x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'SST (°C)'</span> <span class="op">=</span> <span class="st">'temp'</span><span class="op">)</span>,</span>
<span>            effort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Area swept (ha)'</span> <span class="op">=</span> <span class="st">'area_swept'</span><span class="op">)</span>,</span>
<span>            dist <span class="op">=</span> <span class="st">'zinbl'</span>,</span>
<span>            shape <span class="op">=</span> <span class="st">'rdp'</span>,</span>
<span>            subset_prop <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">spec</span><span class="op">$</span><span class="fu">subset</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 4</span></span>
<span><span class="co">##  $ train:List of 10</span></span>
<span><span class="co">##   ..$ y          : int [1:699] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..$ x          : num [1:699] 7.49 11.78 7.01 6.45 11.05 ...</span></span>
<span><span class="co">##   ..$ eff        : num [1:699] 1.4 1.69 1.44 1.64 1.66 ...</span></span>
<span><span class="co">##   ..$ N          : int 699</span></span>
<span><span class="co">##   ..$ Nz         : int 673</span></span>
<span><span class="co">##   ..$ x_range    : num 7.18</span></span>
<span><span class="co">##   ..$ x_pos_range: num 1.82</span></span>
<span><span class="co">##   ..$ x_min      : num 5.5</span></span>
<span><span class="co">##   ..$ x_pos_min  : num 6.28</span></span>
<span><span class="co">##   ..$ y_max      : int 2124</span></span>
<span><span class="co">##  $ all  :'data.frame':   2330 obs. of  4 variables:</span></span>
<span><span class="co">##   ..$ y  : int [1:2330] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..$ x  : num [1:2330] 12.45 8.92 8.5 11.85 10.51 ...</span></span>
<span><span class="co">##   ..$ eff: num [1:2330] 1.7 1.34 1.7 1.4 1.51 ...</span></span>
<span><span class="co">##   ..$ set: chr [1:2330] "train" "test" "train" "train" ...</span></span>
<span><span class="co">##  $ prop : num 0.3</span></span>
<span><span class="co">##  $ seed : NULL</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="b--verify-initial-model-specification">B. Verify initial model specification<a class="anchor" aria-label="anchor" href="#b--verify-initial-model-specification"></a>
</h2>
<div class="section level3">
<h3 id="prior-probabilities-of-parameter-values">Prior probabilities of parameter values<a class="anchor" aria-label="anchor" href="#prior-probabilities-of-parameter-values"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_prior_dens.html">check_prior_dens</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="linked-zero-inflation_files/figure-html/check-prior-dens-1.png" alt="TODO: add legend for median, 50%HDI and 99% line!" width="100%"><p class="caption">
TODO: add legend for median, 50%HDI and 99% line!
</p>
</div>
</div>
<div class="section level3">
<h3 id="prior-predictions-for-the-modskurt-mean">Prior predictions for the <code>modskurt</code> mean<a class="anchor" aria-label="anchor" href="#prior-predictions-for-the-modskurt-mean"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_prior_mskt.html">check_prior_mskt</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="linked-zero-inflation_files/figure-html/check-prior-mskt-1.png" alt="TODO: add legend for alpha!" width="100%"><p class="caption">
TODO: add legend for alpha!
</p>
</div>
</div>
<div class="section level3">
<h3 id="prior-predictions-for-summary-statistics-of-y">Prior predictions for summary statistics of <span class="math inline">\(y\)</span><a class="anchor" aria-label="anchor" href="#prior-predictions-for-summary-statistics-of-y"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_prior_dist.html">check_prior_dist</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span></span></code></pre></div>
<p><img src="linked-zero-inflation_files/figure-html/check-prior-dist-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="prior-predictions-for-probability-of-excess-zero-pi">Prior predictions for probability of excess zero <span class="math inline">\(\pi\)</span><a class="anchor" aria-label="anchor" href="#prior-predictions-for-probability-of-excess-zero-pi"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_prior_zero.html">check_prior_zero</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span></span></code></pre></div>
<p><img src="linked-zero-inflation_files/figure-html/check-prior-zero-1.png" width="100%" style="display: block; margin: auto;"></p>
<p><em>OPTIONAL</em>: refine model spec further</p>
</div>
</div>
<div class="section level2">
<h2 id="c--fit-subset-model">C. Fit subset model<a class="anchor" aria-label="anchor" href="#c--fit-subset-model"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_subset</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/mskt_fit.html">mskt_fit</a></span><span class="op">(</span><span class="va">spec</span>,</span>
<span>           use_subset <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           iter_warmup <span class="op">=</span> <span class="fl">200</span>,</span>
<span>           iter_sampling <span class="op">=</span> <span class="fl">100</span>,</span>
<span>           chains <span class="op">=</span> <span class="fl">6</span>,</span>
<span>           parallel_chains <span class="op">=</span> <span class="fl">6</span>,</span>
<span>           <span class="co"># debug_init = TRUE,</span></span>
<span>           show_messages <span class="op">=</span> <span class="cn">TRUE</span>, show_exceptions <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_computation.html">check_computation</a></span><span class="op">(</span><span class="va">fit_subset</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## spec: zinbl[Hmsrdp] using 699 obs out of 2330 (30% sample)</span></span>
<span><span class="co">## post: 6 chains each with 100 draws (600 total)</span></span></code></pre>
<pre><code><span><span class="co">## $summary</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 10</span></span></span>
<span><span class="co">##   <span style="font-weight: bold;">variable</span>    <span style="font-weight: bold;">mean</span>  <span style="font-weight: bold;">median</span>      <span style="font-weight: bold;">sd</span>     <span style="font-weight: bold;">mad</span>     <span style="font-weight: bold;">q5</span>     <span style="font-weight: bold;">q95</span>   <span style="font-weight: bold;">rhat</span>  <span style="font-weight: bold;">ess_bulk</span></span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;num&gt;</span> <span style="color: #949494; font-style: italic;">&lt;rhat&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;ess&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> H        277.    221.    194.    130.    94.7   657.      1.02 203 (0.3)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> m          6.70    6.67    <span style="color: #949494;">0.</span>200   <span style="color: #949494;">0.</span>201  6.40    7.07    <span style="background-color: #BBBB00;">1.05</span> 101 (0.2)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> s          <span style="color: #949494;">0.</span>389   <span style="color: #949494;">0.</span>348   <span style="color: #949494;">0.</span>172   <span style="color: #949494;">0.</span>156  <span style="color: #949494;">0.</span>168   <span style="color: #949494;">0.</span>712   1.03 182 (0.3)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> r          <span style="color: #949494;">0.</span>672   <span style="color: #949494;">0.</span>704   <span style="color: #949494;">0.</span>191   <span style="color: #949494;">0.</span>199  <span style="color: #949494;">0.</span>317   <span style="color: #949494;">0.</span>934   1.02 242 (0.4)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> d          2.65    1.98    2.18    1.58   <span style="color: #949494;">0.</span>449   7.07    1.02 197 (0.3)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> p          1.07    1.07    <span style="color: #949494;">0.</span>515   <span style="color: #949494;">0.</span>653  <span style="color: #949494;">0.</span>246   1.85    1.02 335 (0.6)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> kap        2.10    2.08    <span style="color: #949494;">0.</span>238   <span style="color: #949494;">0.</span>233  1.74    2.55    1.01 282 (0.5)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> g0[1]      3.94    3.89    <span style="color: #949494;">0.</span>345   <span style="color: #949494;">0.</span>359  3.42    4.51    1.04 171 (0.3)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span> g1[1]      1.05    1.05    <span style="color: #949494;">0.</span>276   <span style="color: #949494;">0.</span>291  <span style="color: #949494;">0.</span>596   1.50    1.04 161 (0.3)</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: </span><span style="color: #949494; font-weight: bold;">ess_tail</span><span style="color: #949494;"> &lt;ess&gt;</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $diagnostics</span></span>
<span><span class="co">##   chain_id warmup sampling total num_divergent num_max_treedepth     ebfmi</span></span>
<span><span class="co">## 1        1  6.001    2.660 8.661             2                 0 0.8508828</span></span>
<span><span class="co">## 2        2  5.811    2.454 8.265             1                 0 1.1861269</span></span>
<span><span class="co">## 3        3  4.542    2.105 6.647             5                 0 1.0944825</span></span>
<span><span class="co">## 4        4  4.674    1.789 6.463            18                 0 0.9643593</span></span>
<span><span class="co">## 5        5  6.072    2.898 8.970             2                 0 1.0613385</span></span>
<span><span class="co">## 6        6  6.250    2.338 8.588             1                 0 0.8744557</span></span></code></pre>
<p><em>OPTIONAL</em>: refine model spec or fit parameters</p>
<div class="section level3">
<h3 id="check-subset-model">Check subset model<a class="anchor" aria-label="anchor" href="#check-subset-model"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># visual display of chain mixing and prior-data conflicts</span></span>
<span><span class="fu"><a href="../reference/check_post_dens.html">check_post_dens</a></span><span class="op">(</span><span class="va">fit_subset</span>, by_chain <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="linked-zero-inflation_files/figure-html/check-post-dens-subset-1.png" width="100%" style="display: block; margin: auto;"></p>
<!-- One out of six chains got confused between NB with high dispersion and ZINBL with low dispersion. This is a shortcoming and positive at the same time. It tells us that the model could have multiple solutions (that would be harder to identify with MLE unless do multiple fits). Best to try with more warmup samples to see if they all find the same mode. -->
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># uses test set for discrete pit</span></span>
<span><span class="fu"><a href="../reference/check_post_calibration.html">check_post_calibration</a></span><span class="op">(</span><span class="va">fit_subset</span><span class="op">)</span></span></code></pre></div>
<p><img src="linked-zero-inflation_files/figure-html/check-post-calibration-subset-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>The slight increase suggests the model is struggling to capture
overdispersion in the upper quantiles of data. However it appears
well-calibrated for the rest of the dist? Compare with a NB model.</p>
<p><em>OPTIONAL</em>: refine model spec or fit parameters</p>
</div>
</div>
<div class="section level2">
<h2 id="d--fit-full-model">D. Fit full model<a class="anchor" aria-label="anchor" href="#d--fit-full-model"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_full</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/mskt_fit.html">mskt_fit</a></span><span class="op">(</span><span class="va">spec</span>,</span>
<span>           chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>           parallel_chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>           <span class="co"># sparse data can require a little more computing care</span></span>
<span>           <span class="co"># default is 0.80</span></span>
<span>           <span class="co"># adapt_delta = 0.90,</span></span>
<span>           <span class="co"># for testing</span></span>
<span>           debug_init <span class="op">=</span> <span class="cn">FALSE</span>, show_messages <span class="op">=</span> <span class="cn">TRUE</span>, show_exceptions <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_computation.html">check_computation</a></span><span class="op">(</span><span class="va">fit_full</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## spec: zinbl[Hmsrdp] using 2330 obs out of 2330 (100% sample)</span></span>
<span><span class="co">## post: 4 chains each with 1000 draws (4000 total)</span></span></code></pre>
<pre><code><span><span class="co">## $summary</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 10</span></span></span>
<span><span class="co">##   <span style="font-weight: bold;">variable</span>    <span style="font-weight: bold;">mean</span>  <span style="font-weight: bold;">median</span>      <span style="font-weight: bold;">sd</span>     <span style="font-weight: bold;">mad</span>      <span style="font-weight: bold;">q5</span>      <span style="font-weight: bold;">q95</span>   <span style="font-weight: bold;">rhat</span>   <span style="font-weight: bold;">ess_bulk</span></span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;num&gt;</span> <span style="color: #949494; font-style: italic;">&lt;rhat&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;ess&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> H        864.    792.    343.    257.    476.    <span style="text-decoration: underline;">1</span>48<span style="color: #949494;">4</span>.         1 3132 (0.8)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> m          6.61    6.60    <span style="color: #949494;">0.</span>148   <span style="color: #949494;">0.</span>157   6.39     6.87       1 1651 (0.4)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> s          <span style="color: #949494;">0.</span>544   <span style="color: #949494;">0.</span>513   <span style="color: #949494;">0.</span>160   <span style="color: #949494;">0.</span>135   <span style="color: #949494;">0.</span>346    <span style="color: #949494;">0.</span>844      1 1998 (0.5)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> r          <span style="color: #949494;">0.</span>795   <span style="color: #949494;">0.</span>822   <span style="color: #949494;">0.</span>135   <span style="color: #949494;">0.</span>132   <span style="color: #949494;">0.</span>527    <span style="color: #949494;">0.</span>962      1 1703 (0.4)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> d          1.86    1.70    <span style="color: #949494;">0.</span>943   <span style="color: #949494;">0.</span>852   <span style="color: #949494;">0.</span>596    3.57       1 1890 (0.5)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> p          <span style="color: #949494;">0.</span>796   <span style="color: #949494;">0.</span>693   <span style="color: #949494;">0.</span>533   <span style="color: #949494;">0.</span>611   <span style="color: #949494;">0.</span>106    1.76       1 2598 (0.6)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> kap        2.33    2.32    <span style="color: #949494;">0.</span>145   <span style="color: #949494;">0.</span>144   2.10     2.57       1 3055 (0.8)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> g0[1]      4.40    4.39    <span style="color: #949494;">0.</span>251   <span style="color: #949494;">0.</span>255   4.01     4.83       1 2288 (0.6)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span> g1[1]      1.21    1.21    <span style="color: #949494;">0.</span>190   <span style="color: #949494;">0.</span>189   <span style="color: #949494;">0.</span>908    1.53       1 2271 (0.6)</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: </span><span style="color: #949494; font-weight: bold;">ess_tail</span><span style="color: #949494;"> &lt;ess&gt;</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $diagnostics</span></span>
<span><span class="co">##   chain_id warmup sampling   total num_divergent num_max_treedepth     ebfmi</span></span>
<span><span class="co">## 1        1 68.736   57.969 126.705            24                 0 0.9714918</span></span>
<span><span class="co">## 2        2 62.473   66.268 128.741            18                 0 0.9745719</span></span>
<span><span class="co">## 3        3 56.298   70.405 126.703            13                 0 0.9514785</span></span>
<span><span class="co">## 4        4 57.881   71.181 129.062            24                 0 1.0103720</span></span></code></pre>
<p><em>OPTIONAL</em>: refine model spec or fit parameters</p>
<div class="section level3">
<h3 id="check-full-model">Check full model<a class="anchor" aria-label="anchor" href="#check-full-model"></a>
</h3>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_post_dens.html">check_post_dens</a></span><span class="op">(</span><span class="va">fit_full</span>, by_chain <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="linked-zero-inflation_files/figure-html/unnamed-chunk-1-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># can be slow for large N</span></span>
<span><span class="fu"><a href="../reference/check_post_influencers.html">check_post_influencers</a></span><span class="op">(</span><span class="va">fit_full</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               pareto_khat Sebastes proriger (CPUE) SST (°C) Area swept (ha)</span></span>
<span><span class="co">## log_lik[1723]        0.50                        0      9.2             1.7</span></span>
<span><span class="co">## log_lik[1986]        0.55                        0      6.4             1.9</span></span>
<span><span class="co">## log_lik[2287]        0.69                        0      6.3             1.8</span></span>
<span><span class="co">## log_lik[2330]        1.63                        0      6.1             1.5</span></span></code></pre>
<p><img src="linked-zero-inflation_files/figure-html/check-post-influencers-full-1.png" width="100%" style="display: block; margin: auto;"></p>
<p><em>OPTIONAL</em>: refine model spec or fit parameters.</p>
</div>
</div>
<div class="section level2">
<h2 id="e--use-the-model">E. Use the model<a class="anchor" aria-label="anchor" href="#e--use-the-model"></a>
</h2>
<div class="section level3">
<h3 id="plot-summaries-of-the-abundance-distribution">Plot summaries of the abundance distribution<a class="anchor" aria-label="anchor" href="#plot-summaries-of-the-abundance-distribution"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the distribution of abundance along the gradient</span></span>
<span><span class="fu"><a href="../reference/abundance_dist.html">abundance_dist</a></span><span class="op">(</span><span class="va">fit_full</span>,</span>
<span>               include_zero_inflation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               summaries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mean'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_sqrt</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="linked-zero-inflation_files/figure-html/use-full-fit-dist-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="calculate-ranges-of-x-for-different-percentages-of-abundance-measures">Calculate ranges of x for different percentages of abundance
measures<a class="anchor" aria-label="anchor" href="#calculate-ranges-of-x-for-different-percentages-of-abundance-measures"></a>
</h3>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/abundance_range.html">abundance_range</a></span><span class="op">(</span><span class="va">fit_full</span>,</span>
<span>                capture_pct <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                using_range <span class="op">=</span> <span class="st">'HAZ'</span>,</span>
<span>                based_on <span class="op">=</span> <span class="st">'mean'</span>,</span>
<span>                include_zero_inflation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                plotted <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">'50% of highest mean counts'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_sqrt</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Species range (see x.avg row) calculated as the  (averaged across posterior draws):</span></span>
<span><span class="co">##                  left       centre        right</span></span>
<span><span class="co">## mean.avg 670.44891756 904.81914000 474.51893029</span></span>
<span><span class="co">## mean.se   49.18261339  53.03304984  27.64652351</span></span>
<span><span class="co">## x.avg      6.33893171   6.61184220   7.51756997</span></span>
<span><span class="co">## x.se       0.02492162   0.01915691   0.02178029</span></span></code></pre>
<p><img src="linked-zero-inflation_files/figure-html/use-full-fit-range-plot-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Hayden Rabel, Adam Smith, Marti Anderson, the team at PRIMER-e.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
